<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32-S3 Web Flasher</title>
    <style>
        /* (Keep your existing styles) */
    </style>
</head>
<body>
    <!-- (Keep your existing HTML structure) -->

    <!-- We'll include the esptool-js files directly -->
    <script src="https://app.unpkg.com/esptool-js@0.5.4/files/lib/util.js"></script>
    <script src="https://app.unpkg.com/esptool-js@0.5.4/files/lib/webserial.js"></script>
    <script src="https://app.unpkg.com/esptool-js@0.5.4/files/lib/reset.js"></script>
    <script src="https://app.unpkg.com/esptool-js@0.5.4/files/lib/stubFlasher.js"></script>
    <script src="https://app.unpkg.com/esptool-js@0.5.4/files/lib/esploader.js"></script>
    
    <script>
        // Modified connect function using local files
        connectButton.addEventListener('click', async () => {
            if (!navigator.serial) {
                showError('Web Serial API not supported. Use Chrome/Edge 89+ or Firefox 101+');
                return;
            }
            
            try {
                statusDiv.className = 'info';
                statusDiv.textContent = 'Requesting serial port...';
                
                port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });
                
                statusDiv.textContent += '\nPort opened. Connecting to ESP32-S3...';
                
                // Initialize using local esptool-js
                esploader = new ESPLoader(port, {
                    debug: true,
                    logFunction: (message) => {
                        statusDiv.textContent += '\n' + message;
                        statusDiv.scrollTop = statusDiv.scrollHeight;
                    }
                });
                
                await esploader.connect();
                
                const chip = await esploader.mainArgs.chip;
                const mac = await esploader.mainArgs.mac;
                
                statusDiv.className = 'success';
                statusDiv.textContent += `\nConnected to ${chip} (MAC: ${mac})`;
                
                flashButton.disabled = false;
                connectButton.disabled = true;
                
            } catch (error) {
                showError(error.message);
                if (port) {
                    try { await port.close(); } catch(e) {}
                }
            }
        });

        // (Keep the rest of your existing JavaScript)
    </script>
</body>
</html>
